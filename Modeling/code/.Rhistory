return(CARpoly_raw)
}
join_CARpoly_to_muni_percentile <- function(CARpoly_raw) {
# turn CARpoly info into spatial points data frame
CARpoly_spdf <- CARpoly_raw %>% filter(year > 0)
CARpoly_spdf$latitude_1 <- CARpoly_spdf$latitude
CARpoly_spdf$longitude_1 <- CARpoly_spdf$longitude
CARpoly_spdf$poly.ids <- 1:nrow(CARpoly_spdf)
coordinates(CARpoly_spdf)<-~longitude_1+latitude_1
crs(CARpoly_spdf) <- CRS("+proj=longlat +datum=WGS84 +no_defs +ellps=WGS84 +towgs84=0,0,0")
# turn spatialxxxDF into sf objects
munis_sf <- st_as_sf(munis)
CARpoly_sf <- st_as_sf(CARpoly_spdf)
# join and rename
CARpoly_joined <- st_join(CARpoly_sf, left = FALSE, munis_sf)
CARpoly_raw <- CARpoly_joined
st_geometry(CARpoly_raw) <- NULL
return(CARpoly_raw)
}
median_CARpoly_raw <- join_CARpoly_to_muni_median(median_CARpoly_raw)
View(median_CARpoly_raw)
library(ggplot2)
library(tidyverse)
library(dplyr)
library(rgdal)
library(raster)
library(sf)
library(sp)
source('E:/R-code/Modeling/code/FCN_clean_csvs.R')
median_cell_raw <- read.csv('E:/R-code/Modeling/data/median_onset_cell_v2.csv')
percentile5_cell_raw <- read.csv('E:/R-code/Modeling/data/percentile5_onset_cell_v2.csv')
percentile95_cell_raw <- read.csv('E:/R-code/Modeling/data/percentile95_onset_cell_v2.csv')
median_muni_raw <- read.csv('E:/R-code/Modeling/data/median_muni_v2.csv')
percentile5_muni_raw <- read.csv('E:/R-code/Modeling/data/percentile5_muni_v2.csv')
percentile95_muni_raw <- read.csv('E:/R-code/Modeling/data/percentile95_muni_v2.csv')
median_CARpoly_raw <- read.csv('E:/R-code/Modeling/data/median_CARpoly_v2.csv')
percentile5_CARpoly_raw <- read.csv('E:/R-code/Modeling/data/percentile5_CARpoly_v2.csv')
percentile95_CARpoly_raw <- read.csv('E:/R-code/Modeling/data/percentile95_CARpoly_v2.csv')
grid_1deg <- readOGR(dsn = 'E:/R-code/Modeling/data/shp/grid_1deg', layer = 'grid_1deg')
munis <- readOGR(dsn = 'E:/R-code/Modeling/data/shp/munis', layer = 'munis_SHP')
crs(munis) <- CRS("+proj=longlat +datum=WGS84 +no_defs +ellps=WGS84 +towgs84=0,0,0")
# change names of CARpoly_raw
rename_cols_median_CARpoly <- function(median_CARpoly_raw) {
output = median_CARpoly_raw %>%
rename(
latitude = latitude_median,
longitude = longitude_median,
onset = onset_median,
onset_historicalRange = onset_historicalRange_median,
double_area_km2 = double_area_km2_sum,
single_area_km2 = single_area_km2_sum,
total_planted_area_km2 = total_planted_area_km2_sum,
year = year_median
) %>%
filter(year > 0)
return(output)
}
rename_cols_percentile5_CARpoly <- function(percentile5_CARpoly_raw) {
output = percentile5_CARpoly_raw %>%
rename(
double_delay_percentile5 = double_delay,
double_harvest_percentile5 = double_harvest,
double_plant_percentile5 = double_plant,
single_delay_percentile5 = single_delay,
single_harvest_percentile5 = single_harvest,
single_plant_percentile5 = single_plant
) %>%
filter(year > 0)
return(output)
}
rename_cols_percentile95_CARpoly <- function(percentile95_CARpoly_raw) {
output = percentile95_CARpoly_raw %>%
rename(
double_delay_percentile95 = double_delay,
double_harvest_percentile95 = double_harvest,
double_plant_percentile95 = double_plant,
single_delay_percentile95 = single_delay,
single_harvest_percentile95 = single_harvest,
single_plant_percentile95 = single_plant
) %>%
filter(year > 0)
return(output)
}
# rename columns of CARpoly data
median_CARpoly_raw <- rename_cols_median_CARpoly(median_CARpoly_raw)
percentile5_CARpoly_raw <- rename_cols_percentile5_CARpoly(percentile5_CARpoly_raw)
percentile95_CARpoly_raw <- rename_cols_percentile95_CARpoly(percentile95_CARpoly_raw)
# join as single dataset and rename
CARpoly_raw <- cbind(median_CARpoly_raw,
percentile5_CARpoly_raw$double_delay_percentile5,
percentile5_CARpoly_raw$double_harvest_percentile5,
percentile5_CARpoly_raw$double_plant_percentile5,
percentile95_CARpoly_raw$double_delay_percentile95,
percentile95_CARpoly_raw$double_harvest_percentile95,
percentile95_CARpoly_raw$double_plant_percentile95)
colnames(CARpoly_raw)[colnames(CARpoly_raw)=="percentile5_CARpoly_raw$double_delay_percentile5"] <- "double_delay_percentile5"
colnames(CARpoly_raw)[colnames(CARpoly_raw)=="percentile5_CARpoly_raw$double_harvest_percentile5"] <- "double_harvest_percentile5"
colnames(CARpoly_raw)[colnames(CARpoly_raw)=="percentile5_CARpoly_raw$double_plant_percentile5"] <- "double_plant_percentile5"
colnames(CARpoly_raw)[colnames(CARpoly_raw)=="percentile95_CARpoly_raw$double_delay_percentile95"] <- "double_delay_percentile95"
colnames(CARpoly_raw)[colnames(CARpoly_raw)=="percentile95_CARpoly_raw$double_harvest_percentile95"] <- "double_harvest_percentile95"
colnames(CARpoly_raw)[colnames(CARpoly_raw)=="percentile95_CARpoly_raw$double_plant_percentile95"] <- "double_plant_percentile95"
join_CARpoly_to_muni_median <- function(CARpoly_raw) {
# turn CARpoly info into spatial points data frame
CARpoly_spdf <- CARpoly_raw %>% filter(year_median > 0)
CARpoly_spdf$latitude <- CARpoly_spdf$latitude_median
CARpoly_spdf$longitude <- CARpoly_spdf$longitude_median
CARpoly_spdf$poly.ids <- 1:nrow(CARpoly_spdf)
coordinates(CARpoly_spdf)<-~longitude+latitude
crs(CARpoly_spdf) <- CRS("+proj=longlat +datum=WGS84 +no_defs +ellps=WGS84 +towgs84=0,0,0")
# turn spatialxxxDF into sf objects
munis_sf <- st_as_sf(munis)
CARpoly_sf <- st_as_sf(CARpoly_spdf)
# join and rename
CARpoly_joined <- st_join(CARpoly_sf, left = FALSE, munis_sf)
CARpoly_raw <- CARpoly_joined
st_geometry(CARpoly_raw) <- NULL
return(CARpoly_raw)
}
join_CARpoly_to_muni_percentile <- function(CARpoly_raw) {
# turn CARpoly info into spatial points data frame
CARpoly_spdf <- CARpoly_raw %>% filter(year > 0)
CARpoly_spdf$latitude_1 <- CARpoly_spdf$latitude
CARpoly_spdf$longitude_1 <- CARpoly_spdf$longitude
CARpoly_spdf$poly.ids <- 1:nrow(CARpoly_spdf)
coordinates(CARpoly_spdf)<-~longitude_1+latitude_1
crs(CARpoly_spdf) <- CRS("+proj=longlat +datum=WGS84 +no_defs +ellps=WGS84 +towgs84=0,0,0")
# turn spatialxxxDF into sf objects
munis_sf <- st_as_sf(munis)
CARpoly_sf <- st_as_sf(CARpoly_spdf)
# join and rename
CARpoly_joined <- st_join(CARpoly_sf, left = FALSE, munis_sf)
CARpoly_raw <- CARpoly_joined
st_geometry(CARpoly_raw) <- NULL
return(CARpoly_raw)
}
median_CARpoly_raw <- join_CARpoly_to_muni_median(median_CARpoly_raw)
head(CARpoly_raw)
library(ggplot2)
library(tidyverse)
library(dplyr)
library(rgdal)
library(raster)
library(sf)
library(sp)
source('E:/R-code/Modeling/code/FCN_clean_csvs.R')
median_cell_raw <- read.csv('E:/R-code/Modeling/data/median_onset_cell_v2.csv')
percentile5_cell_raw <- read.csv('E:/R-code/Modeling/data/percentile5_onset_cell_v2.csv')
percentile95_cell_raw <- read.csv('E:/R-code/Modeling/data/percentile95_onset_cell_v2.csv')
median_muni_raw <- read.csv('E:/R-code/Modeling/data/median_muni_v2.csv')
percentile5_muni_raw <- read.csv('E:/R-code/Modeling/data/percentile5_muni_v2.csv')
percentile95_muni_raw <- read.csv('E:/R-code/Modeling/data/percentile95_muni_v2.csv')
median_CARpoly_raw <- read.csv('E:/R-code/Modeling/data/median_CARpoly_v2.csv')
percentile5_CARpoly_raw <- read.csv('E:/R-code/Modeling/data/percentile5_CARpoly_v2.csv')
percentile95_CARpoly_raw <- read.csv('E:/R-code/Modeling/data/percentile95_CARpoly_v2.csv')
grid_1deg <- readOGR(dsn = 'E:/R-code/Modeling/data/shp/grid_1deg', layer = 'grid_1deg')
munis <- readOGR(dsn = 'E:/R-code/Modeling/data/shp/munis', layer = 'munis_SHP')
crs(munis) <- CRS("+proj=longlat +datum=WGS84 +no_defs +ellps=WGS84 +towgs84=0,0,0")
# rename columns of CARpoly data and combine into a single csv before spatial join
median_CARpoly_raw <- rename_cols_median_CARpoly(median_CARpoly_raw)
percentile5_CARpoly_raw <- rename_cols_percentile5_CARpoly(percentile5_CARpoly_raw)
percentile95_CARpoly_raw <- rename_cols_percentile95_CARpoly(percentile95_CARpoly_raw)
CARpoly_raw <- create_CARpoly_raw(median_CARpoly_raw, percentile5_CARpoly_raw, percentile95_CARpoly_raw)
join_CARpoly_to_muni <- function(CARpoly_raw) {
# turn CARpoly info into spatial points data frame
CARpoly_spdf <- CARpoly_raw %>% filter(year > 0)
CARpoly_spdf$latitude_1 <- CARpoly_spdf$latitude
CARpoly_spdf$longitude_1 <- CARpoly_spdf$longitude
CARpoly_spdf$poly.ids <- 1:nrow(CARpoly_spdf)
coordinates(CARpoly_spdf)<-~longitude_1+latitude_1
crs(CARpoly_spdf) <- CRS("+proj=longlat +datum=WGS84 +no_defs +ellps=WGS84 +towgs84=0,0,0")
# turn spatialxxxDF into sf objects
munis_sf <- st_as_sf(munis)
CARpoly_sf <- st_as_sf(CARpoly_spdf)
# join and rename
CARpoly_joined <- st_join(CARpoly_sf, left = FALSE, munis_sf)
CARpoly_raw <- CARpoly_joined
st_geometry(CARpoly_raw) <- NULL
return(CARpoly_raw)
}
CARpoly_raw <- join_CARpoly_to_muni(CARpoly_raw)
head(CARpoly_raw)
names(CARpoly_raw)
View(CARpoly_raw)
library(ggplot2)
library(tidyverse)
library(dplyr)
library(rgdal)
library(raster)
library(sf)
library(sp)
source('E:/R-code/Modeling/code/FCN_clean_csvs.R')
median_cell_raw <- read.csv('E:/R-code/Modeling/data/median_onset_cell_v2.csv')
percentile5_cell_raw <- read.csv('E:/R-code/Modeling/data/percentile5_onset_cell_v2.csv')
percentile95_cell_raw <- read.csv('E:/R-code/Modeling/data/percentile95_onset_cell_v2.csv')
median_muni_raw <- read.csv('E:/R-code/Modeling/data/median_muni_v2.csv')
percentile5_muni_raw <- read.csv('E:/R-code/Modeling/data/percentile5_muni_v2.csv')
percentile95_muni_raw <- read.csv('E:/R-code/Modeling/data/percentile95_muni_v2.csv')
median_CARpoly_raw <- read.csv('E:/R-code/Modeling/data/median_CARpoly_v2.csv')
percentile5_CARpoly_raw <- read.csv('E:/R-code/Modeling/data/percentile5_CARpoly_v2.csv')
percentile95_CARpoly_raw <- read.csv('E:/R-code/Modeling/data/percentile95_CARpoly_v2.csv')
grid_1deg <- readOGR(dsn = 'E:/R-code/Modeling/data/shp/grid_1deg', layer = 'grid_1deg')
munis <- readOGR(dsn = 'E:/R-code/Modeling/data/shp/munis', layer = 'munis_SHP')
crs(munis) <- CRS("+proj=longlat +datum=WGS84 +no_defs +ellps=WGS84 +towgs84=0,0,0")
# rename columns of CARpoly data and combine into a single csv before spatial join
median_CARpoly_raw <- rename_cols_median_CARpoly(median_CARpoly_raw)
percentile5_CARpoly_raw <- rename_cols_percentile5_CARpoly(percentile5_CARpoly_raw)
percentile95_CARpoly_raw <- rename_cols_percentile95_CARpoly(percentile95_CARpoly_raw)
CARpoly_raw <- create_CARpoly_raw(median_CARpoly_raw, percentile5_CARpoly_raw, percentile95_CARpoly_raw)
join_CARpoly_to_muni <- function(CARpoly_raw) {
# turn CARpoly info into spatial points data frame
CARpoly_spdf <- CARpoly_raw %>% filter(year > 0)
CARpoly_spdf$latitude_1 <- CARpoly_spdf$latitude
CARpoly_spdf$longitude_1 <- CARpoly_spdf$longitude
CARpoly_spdf$poly.ids <- 1:nrow(CARpoly_spdf)
coordinates(CARpoly_spdf)<-~longitude_1+latitude_1
crs(CARpoly_spdf) <- CRS("+proj=longlat +datum=WGS84 +no_defs +ellps=WGS84 +towgs84=0,0,0")
# turn spatialxxxDF into sf objects
munis_sf <- st_as_sf(munis)
CARpoly_sf <- st_as_sf(CARpoly_spdf)
# join and rename
CARpoly_joined <- st_join(CARpoly_sf, left = FALSE, munis_sf)
CARpoly_raw <- CARpoly_joined
st_geometry(CARpoly_raw) <- NULL
return(CARpoly_raw)
}
CARpoly_raw <- join_CARpoly_to_muni(CARpoly_raw)
min_soy_area <- 2 #km2. min area of total or SC/DC soy in cell, muni or property to be considered in model
# median cell
median_cell <- median_cell_raw %>% delete_cols_median_cell() %>%
rename_cols_median_cell()
percentile5_cell <- percentile5_cell_raw %>% filter(year > 0)
percentile95_cell <- percentile95_cell_raw %>% filter(year > 0)
# median muni
median_muni <- median_muni_raw %>% rename_cols_median_muni()
percentile5_muni <- percentile5_muni_raw %>% filter(year > 0)
percentile95_muni <- percentile95_muni_raw %>% filter(year > 0)
# median CARpoly
median_CARpoly <- median_CARpoly_raw %>% rename_cols_median_CARpoly
# create tidy datasets
cell_tidy <- tidy_combine_cell(median_cell, percentile5_cell, percentile95_cell)
muni_tidy <- tidy_combine_muni(median_muni, percentile5_muni, percentile95_muni)
CARpoly_tidy <- tidy_CARpoly(CARpoly_raw)
# categorize numeric variables
cell_tidy <- categorize_vars_cell_tidy(cell_tidy)
cell_untidy <- categorize_vars_cell_untidy(median_cell) # untidy version (to compare SC and DC easily)
muni_tidy <- categorize_vars_muni_tidy(muni_tidy)
muni_untidy <- categorize_vars_muni_untidy(median_muni)
CARpoly_tidy <- categorize_vars_CARpoly_tidy(CARpoly_tidy)
names(CARpoly_tidy)
View(CARpoly_tidy)
library(ggplot2)
library(tidyverse)
library(dplyr)
library(rgdal)
library(raster)
library(sf)
library(sp)
source('E:/R-code/Modeling/code/FCN_clean_csvs.R')
median_cell_raw <- read.csv('E:/R-code/Modeling/data/median_onset_cell_v2.csv')
percentile5_cell_raw <- read.csv('E:/R-code/Modeling/data/percentile5_onset_cell_v2.csv')
percentile95_cell_raw <- read.csv('E:/R-code/Modeling/data/percentile95_onset_cell_v2.csv')
median_muni_raw <- read.csv('E:/R-code/Modeling/data/median_muni_v2.csv')
percentile5_muni_raw <- read.csv('E:/R-code/Modeling/data/percentile5_muni_v2.csv')
percentile95_muni_raw <- read.csv('E:/R-code/Modeling/data/percentile95_muni_v2.csv')
median_CARpoly_raw <- read.csv('E:/R-code/Modeling/data/median_CARpoly_v2.csv')
percentile5_CARpoly_raw <- read.csv('E:/R-code/Modeling/data/percentile5_CARpoly_v2.csv')
percentile95_CARpoly_raw <- read.csv('E:/R-code/Modeling/data/percentile95_CARpoly_v2.csv')
grid_1deg <- readOGR(dsn = 'E:/R-code/Modeling/data/shp/grid_1deg', layer = 'grid_1deg')
munis <- readOGR(dsn = 'E:/R-code/Modeling/data/shp/munis', layer = 'munis_SHP')
crs(munis) <- CRS("+proj=longlat +datum=WGS84 +no_defs +ellps=WGS84 +towgs84=0,0,0")
# rename columns of CARpoly data and combine into a single csv before spatial join
median_CARpoly_raw <- rename_cols_median_CARpoly(median_CARpoly_raw)
percentile5_CARpoly_raw <- rename_cols_percentile5_CARpoly(percentile5_CARpoly_raw)
percentile95_CARpoly_raw <- rename_cols_percentile95_CARpoly(percentile95_CARpoly_raw)
CARpoly_raw <- create_CARpoly_raw(median_CARpoly_raw, percentile5_CARpoly_raw, percentile95_CARpoly_raw)
join_CARpoly_to_muni <- function(CARpoly_raw) {
# turn CARpoly info into spatial points data frame
CARpoly_spdf <- CARpoly_raw %>% filter(year > 0)
CARpoly_spdf$latitude_1 <- CARpoly_spdf$latitude
CARpoly_spdf$longitude_1 <- CARpoly_spdf$longitude
CARpoly_spdf$poly.ids <- 1:nrow(CARpoly_spdf)
coordinates(CARpoly_spdf)<-~longitude_1+latitude_1
crs(CARpoly_spdf) <- CRS("+proj=longlat +datum=WGS84 +no_defs +ellps=WGS84 +towgs84=0,0,0")
# turn spatialxxxDF into sf objects
munis_sf <- st_as_sf(munis)
CARpoly_sf <- st_as_sf(CARpoly_spdf)
# join and rename
CARpoly_joined <- st_join(CARpoly_sf, left = FALSE, munis_sf)
CARpoly_raw <- CARpoly_joined
st_geometry(CARpoly_raw) <- NULL
return(CARpoly_raw)
}
CARpoly_raw <- join_CARpoly_to_muni(CARpoly_raw)
min_soy_area <- 2 #km2. min area of total or SC/DC soy in cell, muni or property to be considered in model
# median cell
median_cell <- median_cell_raw %>% delete_cols_median_cell() %>%
rename_cols_median_cell()
percentile5_cell <- percentile5_cell_raw %>% filter(year > 0)
percentile95_cell <- percentile95_cell_raw %>% filter(year > 0)
# median muni
median_muni <- median_muni_raw %>% rename_cols_median_muni()
percentile5_muni <- percentile5_muni_raw %>% filter(year > 0)
percentile95_muni <- percentile95_muni_raw %>% filter(year > 0)
# median CARpoly
#median_CARpoly <- median_CARpoly_raw %>% rename_cols_median_CARpoly
#percentile5_CARpoly <- percentile5_CARpoly_raw %>% filter(year > 0)
#percentile95_CARpoly <- percentile95_CARpoly_raw %>% filter(year > 0)
# create tidy datasets
cell_tidy <- tidy_combine_cell(median_cell, percentile5_cell, percentile95_cell)
muni_tidy <- tidy_combine_muni(median_muni, percentile5_muni, percentile95_muni)
CARpoly_tidy <- tidy_CARpoly(CARpoly_raw)
names(CARpoly_raw)
library(ggplot2)
library(tidyverse)
library(dplyr)
library(rgdal)
library(raster)
library(sf)
library(sp)
source('E:/R-code/Modeling/code/FCN_clean_csvs.R')
median_cell_raw <- read.csv('E:/R-code/Modeling/data/median_onset_cell_v2.csv')
percentile5_cell_raw <- read.csv('E:/R-code/Modeling/data/percentile5_onset_cell_v2.csv')
percentile95_cell_raw <- read.csv('E:/R-code/Modeling/data/percentile95_onset_cell_v2.csv')
median_muni_raw <- read.csv('E:/R-code/Modeling/data/median_muni_v2.csv')
percentile5_muni_raw <- read.csv('E:/R-code/Modeling/data/percentile5_muni_v2.csv')
percentile95_muni_raw <- read.csv('E:/R-code/Modeling/data/percentile95_muni_v2.csv')
median_CARpoly_raw <- read.csv('E:/R-code/Modeling/data/median_CARpoly_v2.csv')
percentile5_CARpoly_raw <- read.csv('E:/R-code/Modeling/data/percentile5_CARpoly_v2.csv')
percentile95_CARpoly_raw <- read.csv('E:/R-code/Modeling/data/percentile95_CARpoly_v2.csv')
grid_1deg <- readOGR(dsn = 'E:/R-code/Modeling/data/shp/grid_1deg', layer = 'grid_1deg')
munis <- readOGR(dsn = 'E:/R-code/Modeling/data/shp/munis', layer = 'munis_SHP')
crs(munis) <- CRS("+proj=longlat +datum=WGS84 +no_defs +ellps=WGS84 +towgs84=0,0,0")
# rename columns of CARpoly data and combine into a single csv before spatial join
median_CARpoly_raw <- rename_cols_median_CARpoly(median_CARpoly_raw)
percentile5_CARpoly_raw <- rename_cols_percentile5_CARpoly(percentile5_CARpoly_raw)
percentile95_CARpoly_raw <- rename_cols_percentile95_CARpoly(percentile95_CARpoly_raw)
CARpoly_raw <- create_CARpoly_raw(median_CARpoly_raw, percentile5_CARpoly_raw, percentile95_CARpoly_raw)
join_CARpoly_to_muni <- function(CARpoly_raw) {
# turn CARpoly info into spatial points data frame
CARpoly_spdf <- CARpoly_raw %>% filter(year > 0)
CARpoly_spdf$latitude_1 <- CARpoly_spdf$latitude
CARpoly_spdf$longitude_1 <- CARpoly_spdf$longitude
CARpoly_spdf$poly.ids <- 1:nrow(CARpoly_spdf)
coordinates(CARpoly_spdf)<-~longitude_1+latitude_1
crs(CARpoly_spdf) <- CRS("+proj=longlat +datum=WGS84 +no_defs +ellps=WGS84 +towgs84=0,0,0")
# turn spatialxxxDF into sf objects
munis_sf <- st_as_sf(munis)
CARpoly_sf <- st_as_sf(CARpoly_spdf)
# join and rename
CARpoly_joined <- st_join(CARpoly_sf, left = FALSE, munis_sf)
CARpoly_raw <- CARpoly_joined
st_geometry(CARpoly_raw) <- NULL
return(CARpoly_raw)
}
CARpoly_raw <- join_CARpoly_to_muni(CARpoly_raw)
min_soy_area <- 2 #km2. min area of total or SC/DC soy in cell, muni or property to be considered in model
# median cell
median_cell <- median_cell_raw %>% delete_cols_median_cell() %>%
rename_cols_median_cell()
percentile5_cell <- percentile5_cell_raw %>% filter(year > 0)
percentile95_cell <- percentile95_cell_raw %>% filter(year > 0)
# median muni
median_muni <- median_muni_raw %>% rename_cols_median_muni()
percentile5_muni <- percentile5_muni_raw %>% filter(year > 0)
percentile95_muni <- percentile95_muni_raw %>% filter(year > 0)
# median CARpoly
#median_CARpoly <- median_CARpoly_raw %>% rename_cols_median_CARpoly
#percentile5_CARpoly <- percentile5_CARpoly_raw %>% filter(year > 0)
#percentile95_CARpoly <- percentile95_CARpoly_raw %>% filter(year > 0)
# create tidy datasets
cell_tidy <- tidy_combine_cell(median_cell, percentile5_cell, percentile95_cell)
muni_tidy <- tidy_combine_muni(median_muni, percentile5_muni, percentile95_muni)
CARpoly_tidy <- tidy_CARpoly(CARpoly_raw)
# categorize numeric variables
cell_tidy <- categorize_vars_cell_tidy(cell_tidy)
cell_untidy <- categorize_vars_cell_untidy(median_cell) # untidy version (to compare SC and DC easily)
muni_tidy <- categorize_vars_muni_tidy(muni_tidy)
muni_untidy <- categorize_vars_muni_untidy(median_muni)
CARpoly_tidy <- categorize_vars_CARpoly_tidy(CARpoly_tidy)
CARpoly_untidy <- categorize_vars_CARpoly_untidy(median_CARpoly)
# create tidy datasets
cell_tidy <- tidy_combine_cell(median_cell, percentile5_cell, percentile95_cell)
muni_tidy <- tidy_combine_muni(median_muni, percentile5_muni, percentile95_muni)
CARpoly_tidy <- tidy_CARpoly(CARpoly_raw)
# categorize numeric variables
cell_tidy <- categorize_vars_cell_tidy(cell_tidy)
cell_untidy <- categorize_vars_cell_untidy(median_cell) # untidy version (to compare SC and DC easily)
muni_tidy <- categorize_vars_muni_tidy(muni_tidy)
muni_untidy <- categorize_vars_muni_untidy(median_muni)
print(names(median_muni))
CARpoly_tidy <- categorize_vars_CARpoly_tidy(CARpoly_tidy)
CARpoly_untidy <- categorize_vars_CARpoly_untidy(median_CARpoly)
# create tidy datasets
cell_tidy <- tidy_combine_cell(median_cell, percentile5_cell, percentile95_cell)
muni_tidy <- tidy_combine_muni(median_muni, percentile5_muni, percentile95_muni)
CARpoly_tidy <- tidy_CARpoly(CARpoly_raw)
# categorize numeric variables
cell_tidy <- categorize_vars_cell_tidy(cell_tidy)
cell_untidy <- categorize_vars_cell_untidy(median_cell) # untidy version (to compare SC and DC easily)
muni_tidy <- categorize_vars_muni_tidy(muni_tidy)
muni_untidy <- categorize_vars_muni_untidy(median_muni)
CARpoly_tidy <- categorize_vars_CARpoly_tidy(CARpoly_tidy)
CARpoly_untidy <- categorize_vars_CARpoly_untidy(CARpoly_raw)
# categorize as new or old or neither in planted soy age (so far only have it for cell scale)
cell_tidy <- cell_tidy %>% cell_categorize_soy_age()
cell_untidy <- cell_untidy %>% cell_categorize_soy_age()
# choose munis that were planted in 2014 and 2004, merge them
#munis_2014 <- muni_tidy[muni_tidy$year == "2014", c("total_planted_area_km2", "Muni_code")]
#munis_2004 <- muni_tidy[muni_tidy$Muni_code %in% munis_2014$Muni_code &
#                          muni_tidy$year == "2004", c("total_planted_area_km2", "Muni_code")]
#munis_2014 <- munis_2014 %>% rename(area_2014 = total_planted_area_km2)
#munis_2004 <- munis_2004 %>% rename(area_2004 = total_planted_area_km2)
#munis_merged <- merge(munis_2014, munis_2004, by = "Muni_code") %>% unique()
#soy_age <- rep("neither", length(munis_merged$Muni_code))
View(CARpoly_untidy)
View(cell_untidy)
names(CARpoly_raw)
library(ggplot2)
library(tidyverse)
library(dplyr)
library(rgdal)
library(raster)
library(sf)
library(sp)
source('E:/R-code/Modeling/code/FCN_clean_csvs.R')
median_cell_raw <- read.csv('E:/R-code/Modeling/data/median_onset_cell_v2.csv')
percentile5_cell_raw <- read.csv('E:/R-code/Modeling/data/percentile5_onset_cell_v2.csv')
percentile95_cell_raw <- read.csv('E:/R-code/Modeling/data/percentile95_onset_cell_v2.csv')
median_muni_raw <- read.csv('E:/R-code/Modeling/data/median_muni_v2.csv')
percentile5_muni_raw <- read.csv('E:/R-code/Modeling/data/percentile5_muni_v2.csv')
percentile95_muni_raw <- read.csv('E:/R-code/Modeling/data/percentile95_muni_v2.csv')
median_CARpoly_raw <- read.csv('E:/R-code/Modeling/data/median_CARpoly_v2.csv')
percentile5_CARpoly_raw <- read.csv('E:/R-code/Modeling/data/percentile5_CARpoly_v2.csv')
percentile95_CARpoly_raw <- read.csv('E:/R-code/Modeling/data/percentile95_CARpoly_v2.csv')
grid_1deg <- readOGR(dsn = 'E:/R-code/Modeling/data/shp/grid_1deg', layer = 'grid_1deg')
munis <- readOGR(dsn = 'E:/R-code/Modeling/data/shp/munis', layer = 'munis_SHP')
crs(munis) <- CRS("+proj=longlat +datum=WGS84 +no_defs +ellps=WGS84 +towgs84=0,0,0")
# rename columns of CARpoly data and combine into a single csv before spatial join
median_CARpoly_raw <- rename_cols_median_CARpoly(median_CARpoly_raw)
percentile5_CARpoly_raw <- rename_cols_percentile5_CARpoly(percentile5_CARpoly_raw)
percentile95_CARpoly_raw <- rename_cols_percentile95_CARpoly(percentile95_CARpoly_raw)
CARpoly_raw <- create_CARpoly_raw(median_CARpoly_raw, percentile5_CARpoly_raw, percentile95_CARpoly_raw)
join_CARpoly_to_muni <- function(CARpoly_raw) {
# turn CARpoly info into spatial points data frame
CARpoly_spdf <- CARpoly_raw %>% filter(year > 0)
CARpoly_spdf$latitude_1 <- CARpoly_spdf$latitude
CARpoly_spdf$longitude_1 <- CARpoly_spdf$longitude
CARpoly_spdf$poly.ids <- 1:nrow(CARpoly_spdf)
coordinates(CARpoly_spdf)<-~longitude_1+latitude_1
crs(CARpoly_spdf) <- CRS("+proj=longlat +datum=WGS84 +no_defs +ellps=WGS84 +towgs84=0,0,0")
# turn spatialxxxDF into sf objects
munis_sf <- st_as_sf(munis)
CARpoly_sf <- st_as_sf(CARpoly_spdf)
# join and rename
CARpoly_joined <- st_join(CARpoly_sf, left = FALSE, munis_sf)
CARpoly_raw <- CARpoly_joined
st_geometry(CARpoly_raw) <- NULL
return(CARpoly_raw)
}
CARpoly_raw <- join_CARpoly_to_muni(CARpoly_raw)
min_soy_area <- 2 #km2. min area of total or SC/DC soy in cell, muni or property to be considered in model
# median cell
median_cell <- median_cell_raw %>% delete_cols_median_cell() %>%
rename_cols_median_cell()
percentile5_cell <- percentile5_cell_raw %>% filter(year > 0)
percentile95_cell <- percentile95_cell_raw %>% filter(year > 0)
# median muni
median_muni <- median_muni_raw %>% rename_cols_median_muni()
percentile5_muni <- percentile5_muni_raw %>% filter(year > 0)
percentile95_muni <- percentile95_muni_raw %>% filter(year > 0)
# median CARpoly
#median_CARpoly <- median_CARpoly_raw %>% rename_cols_median_CARpoly
#percentile5_CARpoly <- percentile5_CARpoly_raw %>% filter(year > 0)
#percentile95_CARpoly <- percentile95_CARpoly_raw %>% filter(year > 0)
# create tidy datasets
cell_tidy <- tidy_combine_cell(median_cell, percentile5_cell, percentile95_cell)
muni_tidy <- tidy_combine_muni(median_muni, percentile5_muni, percentile95_muni)
CARpoly_tidy <- tidy_CARpoly(CARpoly_raw)
# categorize numeric variables
cell_tidy <- categorize_vars_cell_tidy(cell_tidy)
cell_untidy <- categorize_vars_cell_untidy(median_cell) # untidy version (to compare SC and DC easily)
muni_tidy <- categorize_vars_muni_tidy(muni_tidy)
muni_untidy <- categorize_vars_muni_untidy(median_muni)
CARpoly_tidy <- categorize_vars_CARpoly_tidy(CARpoly_tidy)
CARpoly_untidy <- categorize_vars_CARpoly_untidy(CARpoly_raw)
# change rename cols and delete unnecessary cols
CARpoly_untidy <- CARpoly_untidy %>%
rename(
double_plant = double_plant_median,
double_harvest = double_harvest_median,
dobule_delay = double_delay_median,
single_plant = single_plant_median,
single_harvest = single_harvest_median,
single_delay = single_delay_median
) %>%
subset(select = -c(double_plant_percentile5, single_plant_percentile5,
double_harvest_percentile5, single_plant_percentile5,
double_delay_percentile5, single_delay_percentile5,
double_plant_percentile95, single_plant_percentile95,
double_harvest_percentile95, single_plant_percentile95,
double_delay_percentile95, single_delay_percentile95) )
# categorize as new or old or neither in planted soy age (so far only have it for cell scale)
cell_tidy <- cell_tidy %>% cell_categorize_soy_age()
cell_untidy <- cell_untidy %>% cell_categorize_soy_age()
# choose munis that were planted in 2014 and 2004, merge them
#munis_2014 <- muni_tidy[muni_tidy$year == "2014", c("total_planted_area_km2", "Muni_code")]
#munis_2004 <- muni_tidy[muni_tidy$Muni_code %in% munis_2014$Muni_code &
#                          muni_tidy$year == "2004", c("total_planted_area_km2", "Muni_code")]
#munis_2014 <- munis_2014 %>% rename(area_2014 = total_planted_area_km2)
#munis_2004 <- munis_2004 %>% rename(area_2004 = total_planted_area_km2)
#munis_merged <- merge(munis_2014, munis_2004, by = "Muni_code") %>% unique()
#soy_age <- rep("neither", length(munis_merged$Muni_code))
